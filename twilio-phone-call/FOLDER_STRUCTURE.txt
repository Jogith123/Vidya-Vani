ğŸ“ VIDYA VANI - MODULAR FOLDER STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

twilio-phone-call/
â”‚
â”œâ”€â”€ ğŸ“ database/                    # Database Layer
â”‚   â””â”€â”€ ğŸ“„ connection.js            # MongoDB connection management
â”‚       â”œâ”€â”€ connectToMongoDB()      # Connect & create indexes
â”‚       â”œâ”€â”€ getDatabase()           # Get DB instance
â”‚       â”œâ”€â”€ getClient()             # Get MongoDB client
â”‚       â”œâ”€â”€ closeConnection()       # Graceful shutdown
â”‚       â””â”€â”€ isConnected()           # Check connection status
â”‚
â”œâ”€â”€ ğŸ“ models/                      # Data Models Layer
â”‚   â””â”€â”€ ğŸ“„ History.js               # Question/Answer history model
â”‚       â”œâ”€â”€ insertOne()             # Insert Q&A record
â”‚       â”œâ”€â”€ findByUserId()          # Get user's history
â”‚       â”œâ”€â”€ findByUserIdAndSubject() # Get subject-specific history
â”‚       â”œâ”€â”€ getSubjectStats()       # Get statistics
â”‚       â”œâ”€â”€ getQuestionCount()      # Count questions
â”‚       â”œâ”€â”€ deleteByUserId()        # Delete user data
â”‚       â”œâ”€â”€ getRecentQuestions()    # Get recent Q&As
â”‚       â””â”€â”€ createDocument()        # Create document object
â”‚
â”œâ”€â”€ ğŸ“ services/                    # Business Logic Layer
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ geminiService.js         # Gemini AI operations
â”‚   â”‚   â”œâ”€â”€ initializeGemini()      # Initialize AI client
â”‚   â”‚   â”œâ”€â”€ isInitialized()         # Check if ready
â”‚   â”‚   â”œâ”€â”€ getModel()              # Get model instance
â”‚   â”‚   â”œâ”€â”€ generateAnswer()        # Generate educational answer
â”‚   â”‚   â”œâ”€â”€ classifySubject()       # Classify into subject
â”‚   â”‚   â””â”€â”€ generateSummary()       # Generate learning summary
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ speechService.js         # Google TTS/STT operations
â”‚   â”‚   â”œâ”€â”€ initializeTTS()         # Initialize Text-to-Speech
â”‚   â”‚   â”œâ”€â”€ initializeSTT()         # Initialize Speech-to-Text
â”‚   â”‚   â”œâ”€â”€ isTTSAvailable()        # Check TTS status
â”‚   â”‚   â”œâ”€â”€ isSTTAvailable()        # Check STT status
â”‚   â”‚   â”œâ”€â”€ textToSpeechConvert()   # Text â†’ Audio file
â”‚   â”‚   â””â”€â”€ transcribeAudio()       # Audio â†’ Text
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“„ historyService.js        # History business logic
â”‚       â”œâ”€â”€ storeQuestionAndAnswer() # Store with classification
â”‚       â”œâ”€â”€ getHistoryBySubject()   # Get subject history
â”‚       â”œâ”€â”€ getRecentHistory()      # Get recent questions
â”‚       â””â”€â”€ getUserStats()          # Get user statistics
â”‚
â”œâ”€â”€ ğŸ“ audio/                       # Generated Audio Files
â”‚   â””â”€â”€ answer_*.mp3                # TTS generated audio (auto-created)
â”‚
â”œâ”€â”€ ğŸ“„ server.js                    # Main Express Server (REFACTORED)
â”‚   â”œâ”€â”€ /ivr/welcome                # Entry point endpoint
â”‚   â”œâ”€â”€ /ivr/menu                   # Menu handler
â”‚   â”œâ”€â”€ /ivr/question-recorded      # Recording callback
â”‚   â”œâ”€â”€ /ivr/process-summary        # Summary generation
â”‚   â””â”€â”€ /health                     # Health check
â”‚
â”œâ”€â”€ ğŸ“„ server_old_backup.js         # Backup of old monolithic server
â”‚
â”œâ”€â”€ ğŸ“„ test-mongodb.js              # MongoDB Tests (UPDATED)
â”‚   â”œâ”€â”€ Test connection module
â”‚   â”œâ”€â”€ Test History model
â”‚   â”œâ”€â”€ Test subject classification
â”‚   â””â”€â”€ Test data operations
â”‚
â”œâ”€â”€ ğŸ“„ .env                         # Environment Variables
â”‚   â”œâ”€â”€ MONGODB_URI
â”‚   â”œâ”€â”€ GEMINI_API_KEY
â”‚   â”œâ”€â”€ TWILIO_*
â”‚   â””â”€â”€ GOOGLE_TTS_KEY_FILE
â”‚
â”œâ”€â”€ ğŸ“„ .env.example                 # Environment Template
â”œâ”€â”€ ğŸ“„ package.json                 # Dependencies & Scripts
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git ignore rules
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # Main Documentation
â”œâ”€â”€ ğŸ“„ MONGODB_SETUP.md             # MongoDB Setup Guide
â”œâ”€â”€ ğŸ“„ API_DOCUMENTATION.md         # API Reference
â”œâ”€â”€ ğŸ“„ QUICKSTART.md                # Quick Start Guide
â”œâ”€â”€ ğŸ“„ IMPLEMENTATION_SUMMARY.md    # Implementation Details
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md              # System Architecture
â”œâ”€â”€ ğŸ“„ MODULAR_STRUCTURE.md         # This modular guide
â””â”€â”€ ğŸ“„ FOLDER_STRUCTURE.txt         # This file


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MODULE DEPENDENCIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

server.js
    â”‚
    â”œâ”€â†’ database/connection
    â”‚       â””â”€â†’ mongodb (npm package)
    â”‚
    â”œâ”€â†’ services/geminiService
    â”‚       â””â”€â†’ @google/generative-ai (npm package)
    â”‚
    â”œâ”€â†’ services/speechService
    â”‚       â”œâ”€â†’ @google-cloud/text-to-speech (npm package)
    â”‚       â””â”€â†’ @google-cloud/speech (npm package)
    â”‚
    â””â”€â†’ services/historyService
            â”œâ”€â†’ models/History
            â”‚       â””â”€â†’ database/connection
            â”‚
            â””â”€â†’ services/geminiService


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DATA FLOW EXAMPLE: Ask Question & Get Answer
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. User calls Twilio number
        â†“
2. POST /ivr/welcome (server.js)
        â†“
3. User presses 1 (Ask Question)
        â†“
4. User speaks question
        â†“
5. POST /ivr/question-recorded (server.js)
        â†“
6. speechService.transcribeAudio()
        â”œâ”€â†’ Downloads audio from Twilio
        â””â”€â†’ Google Speech-to-Text API
        â†“
7. User presses 3 (Get Answer)
        â†“
8. getAnswer() in server.js
        â†“
9. geminiService.generateAnswer()
        â””â”€â†’ Google Gemini API
        â†“
10. historyService.storeQuestionAndAnswer()
        â”œâ”€â†’ geminiService.classifySubject()
        â”‚       â””â”€â†’ Google Gemini API
        â”‚
        â””â”€â†’ History.insertOne()
                â””â”€â†’ database/connection
                        â””â”€â†’ MongoDB
        â†“
11. speechService.textToSpeechConvert()
        â””â”€â†’ Google Text-to-Speech API
        â†“
12. Play audio to user


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DATA FLOW EXAMPLE: Get Summary
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. User presses 4 (Get Summary)
        â†“
2. getSummary() in server.js
        â†“
3. User says "Biology"
        â†“
4. POST /ivr/process-summary (server.js)
        â†“
5. speechService.transcribeAudio()
        â””â”€â†’ Transcribe subject name
        â†“
6. historyService.getHistoryBySubject()
        â””â”€â†’ History.findByUserIdAndSubject()
                â””â”€â†’ database/connection
                        â””â”€â†’ MongoDB Query
                                â””â”€â†’ Returns last 5 Biology Q&As
        â†“
7. geminiService.generateSummary()
        â””â”€â†’ Google Gemini API
        â†“
8. speechService.textToSpeechConvert()
        â””â”€â†’ Google Text-to-Speech API
        â†“
9. Play summary to user


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPARISON: OLD vs NEW STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OLD STRUCTURE (Monolithic):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
server.js (803 lines)
â”œâ”€â”€ All MongoDB code
â”œâ”€â”€ All Gemini AI code
â”œâ”€â”€ All TTS/STT code
â”œâ”€â”€ All business logic
â”œâ”€â”€ All route handlers
â””â”€â”€ Everything mixed together âŒ


NEW STRUCTURE (Modular):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
server.js (450 lines) âœ…
    â””â”€â”€ Clean route handlers only

database/connection.js (100 lines) âœ…
    â””â”€â”€ MongoDB management only

models/History.js (180 lines) âœ…
    â””â”€â”€ Data model & queries only

services/geminiService.js (120 lines) âœ…
    â””â”€â”€ AI operations only

services/speechService.js (200 lines) âœ…
    â””â”€â”€ TTS/STT operations only

services/historyService.js (80 lines) âœ…
    â””â”€â”€ Business logic only


BENEFITS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Each file has ONE responsibility
âœ… Easy to find and fix bugs
âœ… Easy to test modules independently
âœ… Easy to add new features
âœ… Easy to understand code flow
âœ… Easy to onboard new developers
âœ… Reusable components
âœ… Scalable architecture


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Run modular tests:
$ npm run test-mongodb

Tests verify:
âœ… database/connection module
âœ… models/History CRUD operations
âœ… services/geminiService classification
âœ… Data queries and aggregations


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QUICK START
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Install dependencies:
   $ npm install

2. Configure .env:
   MONGODB_URI=mongodb+srv://...
   GEMINI_API_KEY=...

3. Test MongoDB:
   $ npm run test-mongodb

4. Start server:
   $ npm run server

5. Make a call and test! ğŸ“


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ MODULAR STRUCTURE COMPLETE! âœ¨

All features working with clean, maintainable code! ğŸ‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
